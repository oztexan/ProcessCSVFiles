<head>
    <link rel='stylesheet' href='https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css' />
    <style>
#main{max-width:1000px;margin:auto;padding:40px;}
button{display:block}
    </style>
</head>
<body>

    <div id='main'>
        <div class='row'>
            <button id='startThread' class='btn btn-primary'>Start Watching</button>
            <div style='clear:both'></div>
        </div>
        <div class='row'>
            <div id='thread_msg'></div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.3.1.min.js" ></script>
    <script type='text/javascript'>
        $(document).ready(function(){
            let alreadyCalled = false;
            let threadInterval = null;
            $('#startThread').on('click',function(){
                if(!alreadyCalled) {
                  $('#startThread').html('Stop Watching');
                  alreadyCalled = true;
                  $.ajax({
                      type: "GET",
                      cache: false,
                      url: "/startThread",
                      dataType: "json",
                      success: function(data) {
                          var msg = $('<div id="placeholder">').text('Task ' + data.status + '')
                          $('#thread_msg').append(msg)
                          var i = 0;
                          threadInterval = setInterval(function(){
                              checkTask("/checkThread", function(check){
                                  msg.text(JSON.stringify(check))
                              })
                          },1000)
                      }
                  })
                } else {
                  stopTask("/stopThread", function(check){
                    alreadCalled = false;
                    window.clearInterval(threadInterval)
                    $('#startThread').html('Start Watching');
                  })
                }
            })

            function stopTask(url,cb){
                $.ajax({
                    type: "GET",
                    cache: false,
                    url: url,
                    dataType: "json",
                    success: function(data) {
                        cb(data)
                    }
                })
            }

            function checkTask(url,cb){
                $.ajax({
                    type: "GET",
                    cache: false,
                    url: url,
                    dataType: "json",
                    success: function(data) {
                        cb(data)
                    }
                })
            }
        })
    </script>
</body>
